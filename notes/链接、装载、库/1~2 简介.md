# 链接、装载、库

## 一、几个基本概念

计算机三大部件：CPU、内存、I/O控制芯片

任务调度：多道程序 -> 分时系统 -> 多任务系统(进程)

分段：把一段程序所需内存空间的大小的虚拟空间映射到某个地址空间，从而解决了地址空间不隔离，程序运行地址不确定

* 问题：内存使用效率低，如内存不足，被换入换出到磁盘的都是整个程序，效率太差； 分页技术解决了这个问题

分页：把地址空间人为等分成固定大小的页，比如4KB

虚拟存储实现需要MMU硬件支持，MMU一般集成在CPU内部

线程：LWP，程序执行流的最小单元，由线程ID、PC、寄存器(私有)、堆栈(私有)组成

* 私有存储：栈、寄存器、TLS

* 进程所有：全局变量、堆、函数里的静态变量、代码、打开的文件

I/O密集型线程总是比CPU密集型线程更容易得到优先级上的提升，因为要满足更多的线程能够执行

内核线程和用户级线程：多对一模型中，如某个用户线程阻塞，所有线程将无法执行，因为此时对应的内核线程也随之阻塞。



## 二、编译和链接

预处理 -> 编译 -> 汇编 -> 链接

编译：词法分析、语法分析、语义分析、优化汇编代码

汇编：调用汇编器as, 输出.o

链接：把各模块间相互引用的部分都处理好，使各模块之间能够正确衔接。过程包含三个重要部分：

* 地址和空间分配 (Address and Storage Allocation)
* 符号决议 (Symbol Resolution)
* 重定位 (Relocation)

**重定位**：以纸带为例，程序被修改时，重新计算各个目标的地址过程被叫做重定位(Relocation)

**符号**：表示一个地址，将程序员从低级繁琐的调整地址的工作中解放出来。