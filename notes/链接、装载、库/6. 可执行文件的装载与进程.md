### 进程的虚拟地址空间

进程只能使用3G(0~0xBFFFFFFF), 剩下给操作系统(0xC0000000~0xFFFFFFFF)

### 装载的方式

程序局部性原理，将程序最常用部分驻留在内存中，将一些不太常用的数据存放到磁盘里，即动态装入的思想

#### 页映射

不是一下子把程序的所有指令和数据装入内存，而是将内存和所有磁盘中的数据和指令按照“页”为单位划分成若干页，以后所有装载和操作的单位就是页。

#### 从操作系统角度看可执行文件的装载

**什么是装载？** 操作系统将可执行程序装载到进程地址空间

一个进程最关键的特征是它拥有的独立的虚拟地址空间，使它有别于其他进程。

* 创建一个独立的虚拟地址空间
* 读取可执行文件头，并且建立虚拟空间与可执行文件的映射关系
* 将CPU的指令寄存器设置成可执行文件的入口地址，启动运行

#### ELF文件链接视图(Section)和执行视图(.Segment)

ELF文件到虚拟空间的映射， 往往不止一个段需要映射(.data, .text, .bss)，段增多时，会产生空间浪费问题。(每个段在映射时的长度应该都是系统页长度的整数倍)

操作系统不关心ELF中各个段具体内容，只关心一些跟装载相关的问题，比如权限，有以下三种情况：

* 以代码段为代表的权限为可读可执行的段 (.text, .init)
* 以数据段和BSS段为代表的可读可写的段
* 以只读数据段为代表的只读的段

#### Segment和Section的概念

Segment的概念实际上是从装载的角度重新划分了ELF的各个段。

ELF可执行文件中的数据结构：程序头表（Program Header Table)保存Segment的信息。结构体数组如下（与readelf -l对应)：

```C
typedef struct {

} Elf32_Phdr;
```





