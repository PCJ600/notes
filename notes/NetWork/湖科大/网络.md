计算机网络体系结构分层思想

以HTTP请求为例

应用层 —— HTTP报文

运输层 —— TCP报文段

网络层 —— IP数据报

数据链路层 —— 帧

物理层 —— 比特流



### MAC地址

##### MAC地址的作用

一段链路对网络接口的标识

##### MAC地址格式

![MAC地址的格式](C:\Users\pc\Desktop\learning\notes\notes\NetWork\湖科大\MAC地址的格式.PNG)

##### MAC地址种类

单播帧， 将自己的MAC地址写入首部

广播帧，将广播地址FF-FF-FF-FF-FF-FF地址写入首部

多播帧， 将多播地址(该地址第一个16进制数不能整除2)

### IP地址

网络编号：标识互联网上数以百万的网

主机编号：标识同一网络上不同的主机

#### 地址解析协议 ARP

如果仅使用数据链路层和物理层通信，可以只使用MAC地址寻址

ARP广播请求： 我的IP地址XXX， 我的MAC地址XXX， 我想知道XX主机的地址

### CSMA/CD协议

载波监听多点接入/碰撞检测(Carrier Sense Multiple Access with Collision Detection)

* 多点接入(MA)  多个主机连接在一条总线上，竞争使用总线
* 载波监听((CS)  发送数据前先检测总线(“先听后说”)

* 碰撞检测(CD) 边发边检测碰撞("边说边听")

争用期 —— 以太网单程端到端传播时延的两倍?, 51.2us, 10Mb/s

最短帧长 —— 512b, 64B。以太网的最短帧长确保了主机可在帧发送完成之前就检测到是否碰撞，如果检测碰撞，则停止发送帧的剩余部分，退避随机时间后，重新发送该帧

##### 截断二进制指数退避算法

退避时间 = 2T * 随机数r (r从离散的整数集合(0,1,...,2^k-1)中随机选一个， k = Min{重传次数，10})

现在的以太网基于交换机和全双工连接，不会有碰撞，因此没有必要使用CSMA/CD

#### 集线器(HUB)

使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用CSMA/CD协议

集线器只工作在物理层，它的每个接口仅简单转发比特，不进行碰撞检测

####  以太网交换机

工作在数据链路层和物理层

收到帧后, 根据帧目的MAC地址和交换机内部的帧交换表对帧进行处理

* 明确的转发 （单播，多播，广播）
* 盲目的转发 （泛洪）
* 明确的丢弃

#### 广播风暴

* 主机收到重复的广播帧
* 交换机的帧交换表震荡

#### 生成树协议

生成树协议(Spanning Tree Protocol)， 提高网络可靠性的同时避免环路带来的各种问题

生成树算法的三个步骤：

* 选举根交换机
* 选举根端口
* 选举指定端口并阻塞备用端口

选举是通过网络中各交换机相互发送生成树协议专用的数据帧BPDU来实现的

##### 1. 选举根交换机

网桥ID最小者当选， 网桥ID由以下两部分组成：

* 优先级：范围 0 ~ 61440， 步长：4096， 默认值：32768

* 交换机的基本MAC地址

网桥ID的比较方法：

1. 优先级取值越小，则网桥ID越小
2. 若优先级相同，则比较MAC地址，从MAC地址左侧比较，数值小的，网桥ID就小

##### 2.选举根端口

在每一个非根交换机上选出一个根端口RP(Root Port)，并且只能是一个

根端口RP用于接收根交换机发来的BPDU，也用来转发普通流量。选举条件如下：

* BPDU接收端口到根交换机的路径成本最小
* 对端的网桥ID最小
* 对端的端口ID最小

对端的端口ID比较方法：

* 优先级：范围 0 ~ 240，步长：16，默认值：128

* 端口号

##### 3.选举指定端口并阻塞备用端口

在每一个网段上选出一个指定端口DP(Designed Port)，并且只能是一个

选举条件

* 根交换机的所有端口都是指定端口
* 根端口的对端端口一定是指定端口
* BPDU转发端口到根交换机的路径成本最小
* 本端的网桥ID最小

最后，剩余端口成为备用端口AP (Alternate Port)， 将它们阻塞

#### VLAN

Virtual Local Area Network ： 将局域网内的设备划分成与物理位置无关的逻辑组的技术

网络中频繁出现广播信息 ARP，RIP，DHCP...， 需要分割广播域

#### 如何分割广播域

* 路由器

* 划分VLAN

交换机上生成的各VLAN是互不相通

实现VLAN间通信：

* 路由器
* 三层交换机

##### IEEE 802.1Q帧

对以太网帧格式进行了扩展，插入了4字节的VLAN标记(tag)

VLAN标记的最后12位称为VLAN标识符VID，它唯一标志了以太网帧属于哪一个VLAN

802.1Q帧由交换机来处理的，而不是用户主机来处理的

* 交换机收到普通的以太网帧，会将其插入4字节VLAN标记进而转变为802.1Q帧，简称“打标签”
* 交换机转发802.1Q帧，可能会删除其4字节VLAN标记进而转变为普通以太网帧，简称"去标签"

#### 交换机端口类型

##### Access类型

* Access端口一般用于连接用户计算机
* Access端口只能属于一个VLAN
* Access端口的PVID值与端口所属的VLAN的ID相同, 默认为1
* 接收处理方法：
  * 一般只接受未打标签的数据帧，即普通以太网数据帧
* 发送处理方法：
  * 当收到未打标签的数据帧时，根据接收该帧的端口的PVID，给帧打标签，字段中VID取值与端口PVID取值相等

##### Trunk类型

* 交换机之间或交换机和路由器之间的连接
* 可以属于多个VLAN
* 用户可以设置PVID，默认为1
* 接收处理方法：
  * 接收“已打标签”的数据帧，不管数据帧中VID是否等于端口PVID
  * 接收未打标签的数据帧，根据端口的PVID值给帧打标签，即插入4字节VLAN ID字段，字段中的VID取值与端口PVID取值相等
* 发送处理方法：
  * 对于数据帧中的VID等于端口PVID的数据帧，去标签后转发
  * 对于数据帧中的VID不等于端口PVID的数据帧，直接转发





































