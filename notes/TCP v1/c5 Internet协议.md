## Internet协议

#### 如何理解IP的无连接和不可靠，尽力而为？

尽力而为: 不保证IP数据报能成功到达目的地

无连接：IP不维护网络单元(路由器)中数据报相关的任何链接状态信息，每个数据报独立与其他数据报处理，意味着IP数据报**可不按顺序交付**

#### IPV4数据报(tcpdump抓包观察)

![image-20200403225647019](C:\Users\pc\AppData\Roaming\Typora\typora-user-images\image-20200403225647019.png)

一个32位值的4字节按以下顺序传输：0-7， 8-15， 16-23， 24-31， **网络字节序**

**版本字段**为4

**Internet头部长度**(IHL)保存v4头部中32位字的数量，包括任何选项。无选项时为5， 头部20 / 4 = 5

**TOS**,前六位区分服务字段(DS字段)，后两位是显式拥塞通知字段或指示位

16位总长度指IPV4数据报的总长度，由于16位字段，最大长度为65536个字节

```shell
listening on lo, link-type EN10MB (Ethernet), capture size 262144 bytes
22:16:02.948272 IP 192.168.43.240.55586 > 192.168.43.240.9877: Flags [S], seq 2229160269, win 43690, options [mss 65495,sackOK,TS val 303027 ecr 0,nop,wscale 7], length 0
        0x0000:  4500 003c d6fe 4000 4006 8a8c c0a8 2bf0  E..<..@.@.....+.
        0x0010:  c0a8 2bf0 d922 2695 84de 494d 0000 0000  ..+.."&...IM....
        0x0020:  a002 aaaa d95f 0000 0204 ffd7 0402 080a  ....._..........
        0x0030:  0004 9fb3 0000 0000 0103 0307            ............
```

举例: 版本为4,  IHL为5， 服务类型TOS为0， 总长度为0x3c，即60字节。16位标识为d6fe,3位标识为0x10,13位片偏移0，TTL为0x40，8位协议0x06, 16位校验和8a8c， 源IP地址 c0a8 2bf0(192.168.43.240)， 目的IP地址c0a8 2bf0(192.168.43.240)， TCP报文段











